<!DOCTYPE html>
<html>
<head>
    <title>MOONEY Mint</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
    <style>
        body{text-align:center;padding:50px;}
        button{padding:15px 30px;font-size:18px;margin:10px;}
        #connect{background:#0071e3;color:white;border:none;}
        #mint{background:#ccc;color:white;border:none;}
    </style>
</head>
<body>
    <h1>MOONEY Mint（Base链）</h1>
    <button id="connect">连接OKX钱包</button>
    <button id="mint" disabled> Mint（5 USDC）</button>
    <p id="msg">请连接钱包</p>

    <script>
        const contractAddr = "0x14E8372E5cD2a5Da76B87d610475a66020F540A1";
        const baseChainId = "0x2105";
        let provider, signer;

        document.getElementById("connect").onclick = async () => {
            if (!window.okxwallet) {
                document.getElementById("msg").style.color="red";
                document.getElementById("msg").textContent="请安装OKX钱包";
                return;
            }
            await window.okxwallet.request({method: "eth_requestAccounts"});
            provider = new ethers.providers.Web3Provider(window.okxwallet);
            signer = provider.getSigner();
            await window.okxwallet.request({
                method: "wallet_switchEthereumChain",
                params: [{chainId: baseChainId}]
            }).catch(async ()=>{
                await window.okxwallet.request({
                    method: "wallet_addEthereumChain",
                    params: [{
                        chainId: baseChainId,
                        chainName: "Base",
                        rpcUrls: ["https://mainnet.base.org"],
                        nativeCurrency: {name: "ETH", symbol: "ETH", decimals: 18},
                        blockExplorerUrls: ["https://basescan.org"]
                    }]
                });
            });
            document.getElementById("msg").style.color="green";
            document.getElementById("msg").textContent="已连接钱包";
            document.getElementById("connect").disabled=true;
            document.getElementById("mint").disabled=false;
        };

        document.getElementById("mint").onclick = async () => {
            const usdcAddr = "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913";
            const usdcAbi = [{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"type":"function"}];
            const usdcContract = new ethers.Contract(usdcAddr, usdcAbi, signer);
            await usdcContract.approve(contractAddr, ethers.utils.parseUnits("5", 6));
            
            const mintAbi = [{"inputs":[],"name":"mint","outputs":[],"type":"function"}];
            const mintContract = new ethers.Contract(contractAddr, mintAbi, signer);
            const tx = await mintContract.mint();
            await tx.wait();
            document.getElementById("msg").textContent="Mint成功！哈希："+tx.hash.slice(0,10);
        };
    </script>
</body>
</html>